# Введение Spectrogram

```diff
- В данном проекте использовались библиотеки: CUDA, OpenCV, CVPlot, fftw.
```

В данной лабораторной работе содержится 7 файлов.
1. Заголовочный файл - main.h, в котором подгружаются все библиотеки, находятся параметры для работы программы, прототипы функций и структур
2. Основной файл - main.cpp, через который происходит запуск программы
3. Функция для чтения wav файлов - WavReader.cpp
4. Функция для построения спектра через CPU - spectrogram.cpp
5. Функция для построения спектра через GPU - spectrogram_cuda.cu
6. Функция для отображения изображений - imageView.cpp
7. Функция для красивого отображения текста - just_output.cpp

# Параметры

В main.h находятся параметры , с помощью которых, можно регулировать работу программы:
1. mode - Режим отображения данных (0 - не отображать и не сохранять, 1 - отображать изображения, 2 - сохранять изображения, 3 - отображать и сохранять)
2. interactive - Режим интерактивных графиков (0 - выключить, 1 - включить)
3. multichannel - Режим мультикональности на одном изображении (0 - на разных изображениях, 1 - на одном изображении)
4. output - Показ изображений (0 - все изображения, 1 - только спектры)
5. processor - Использование процессора (0 - CPU, 1 - GPU, 2 - CPU & GPU)

# Функции

Файл main.cpp, является основным, с помощью которого происходит запуск программы. В нем вызываются функции чтения и обработки данных, а также измеряется время выполнения программы.

Чтения данных осуществляется через функцию wav_Reader. Для начала файл проходит проверку на то, является ли он wav файлом и имеет ли нужную структуру, после чего проиходит чтение data данных и их обработка в double формат. А дальше, в зависимости от колличества каналов, происходит выгрузка данных в вектора.

Построение спектра на CPU происходит посредством функции spectrogram_from_signal, на GPU посредством spectrogram_from_signal_cuda. Основная механика данных функций схожа, создаются комплексные и векторные переменные по заданному размеру, в зависимости от количества каналов. А после для каждого из каналов вызывается функция, в которой происходит БПФ и последующая обработка данных.

В данных блоках содержится основной код программы, а именно реализация инициализации матриц, и две основные функии **matrixMulCPU** и **matrixMulGPU**.
- matrixMulCPU - выполняет последовательный рассчет на CPU.
- matrixMulGPU - выполняет параллельный расчет на GPU.

Распараллеливание просиходило в момент времени, когда нужно было рассчитывать элемент произведения матриц А и В. Это позволяет достигнуть максимально возможной скорости вычисления. Так как одновременно может рассчитываться множество эллементов.

Ниже представлены графики зависимости, составленные по таблице
![CPU](https://user-images.githubusercontent.com/31400073/194624612-3683dfd0-4b2e-4ca4-b42a-f6f08390893a.png)

![GPU](https://user-images.githubusercontent.com/31400073/194624626-1dd16c18-edc6-406c-a96d-3abb8d688959.png)

![acc](https://user-images.githubusercontent.com/31400073/194624753-30a4d091-47ea-4906-9e32-fb0da780f4aa.png)

А также ниже представлен пример из консоли, где перемножались две матрицы размером 8192 x 8192 элемента. 
###### Здесь отчетливо видна разница во времени расчетов.

![example](https://user-images.githubusercontent.com/31400073/194625504-23bed79a-c5ad-477a-b7b3-a9ab5de5900d.jpg)
